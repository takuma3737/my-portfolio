# Implementation Plan

- [-] 1. プロジェクト基盤と OpenAPI 仕様の作成

  - OpenAPI 仕様ファイル（schema/openapi.yaml）を作成し、全 API エンドポイントを定義する
  - sqlc 設定ファイル（sqlc.yaml）を作成し、PostgreSQL 用の設定を行う
  - Go modules の依存関係を追加（PostgreSQL、oapi-codegen、crypto 等）
  - _Requirements: 全要件_

- [ ] 2. データベース設計と初期設定

  - [ ] 2.1 データベーススキーマファイルの作成

    - schema.sql ファイルで comments と likes テーブルを定義する
    - UNIQUE 制約とインデックスを適切に設定する
    - _Requirements: 1, 2, 6, 7_

  - [ ] 2.2 SQL クエリファイルの作成
    - comments.sql でコメント関連の CRUD 操作を定義する
    - likes.sql でいいね関連の操作を定義する
    - sqlc で Go コードを生成する
    - _Requirements: 1, 2, 6, 7_

- [ ] 3. Domain 層の実装

  - [ ] 3.1 Comment ドメインモデルの実装

    - Comment 構造体とバリデーション関数を作成する
    - ビジネスルールを実装する
    - _Requirements: 1, 5, 6, 7_

  - [ ] 3.2 Like ドメインモデルの実装
    - Like 構造体とバリデーション関数を作成する
    - ビジネスルールを実装する
    - _Requirements: 2_

- [ ] 4. Repository 層の実装

  - [ ] 4.1 データベース接続の実装

    - PostgreSQL 接続プールの設定を行う
    - 環境変数から DB 接続情報を取得する機能を実装する
    - _Requirements: 全要件_

  - [ ] 4.2 CommentRepository の実装

    - sqlc 生成コードと Domain 型の変換関数を実装する
    - コメントの CRUD 操作を実装する
    - 権限チェック付きの更新・削除機能を実装する
    - _Requirements: 1, 5, 6, 7_

  - [ ] 4.3 LikeRepository の実装
    - sqlc 生成コードと Domain 型の変換関数を実装する
    - いいねの追加・削除・カウント機能を実装する
    - ユーザーのいいね状態確認機能を実装する
    - _Requirements: 2_

- [ ] 5. 署名 Cookie 認証システムの実装

  - [ ] 5.1 署名 Cookie 生成・検証機能の実装

    - ランダム UID 生成機能を実装する（crypto/rand 使用）
    - HMAC-SHA256 による署名生成・検証機能を実装する
    - Cookie 有効期限（30 日）の管理機能を実装する
    - 秘密鍵の環境変数からの読み込み機能を実装する
    - _Requirements: 6, 7, 8_

  - [ ] 5.2 認証ミドルウェアの実装
    - HTTP リクエストから署名 Cookie を抽出する機能を実装する
    - 署名の検証と UID 抽出機能を実装する
    - Cookie 期限切れ時の自動再発行機能を実装する
    - エラーハンドリングを実装する
    - _Requirements: 6, 7, 8_

- [ ] 6. UseCase 層の実装

  - [ ] 6.1 CommentUseCase の実装

    - コメント一覧取得のビジネスロジックを実装する
    - コメント投稿のビジネスロジックを実装する
    - コメント編集・削除のビジネスロジックを実装する
    - _Requirements: 1, 5, 6, 7_

  - [ ] 6.2 LikeUseCase の実装
    - いいね数取得のビジネスロジックを実装する
    - いいねトグル機能のビジネスロジックを実装する
    - ユーザーのいいね状態確認のビジネスロジックを実装する
    - _Requirements: 2_

- [ ] 7. Handler 層の実装

  - [ ] 7.1 OpenAPI コード生成と Converter 実装

    - oapi-codegen で Go コードを生成する
    - OpenAPI 型と Domain 型の変換関数を実装する
    - エラーレスポンスの統一フォーマットを実装する
    - _Requirements: 全要件_

  - [ ] 7.2 CommentHandler の実装

    - コメント一覧取得 API を実装する
    - コメント投稿 API を実装する
    - コメント編集・削除 API を実装する
    - _Requirements: 1, 5, 6, 7_

  - [ ] 7.3 LikeHandler の実装

    - いいね数取得 API を実装する
    - いいねトグル API を実装する
    - _Requirements: 2_

  - [ ] 7.4 AuthHandler の実装
    - 署名 Cookie 発行機能を実装する（初回アクセス時）
    - Cookie 再発行 API（必要に応じて）を実装する
    - _Requirements: 6, 7, 8_

- [ ] 8. バックエンドサーバーの統合

  - [ ] 8.1 HTTP サーバーの設定

    - net/http でサーバーを起動する機能を実装する
    - ルーティングの設定を行う
    - CORS の設定を行う
    - _Requirements: 全要件_

  - [ ] 8.2 エラーハンドリングとログ設定
    - 統一されたエラーハンドリングを実装する
    - ログ出力の設定を行う
    - パニック回復の仕組みを実装する
    - _Requirements: 全要件_

- [ ] 9. フロントエンド実装

  - [ ] 9.1 TypeScript クライアント生成と設定

    - OpenAPI から TypeScript クライアントを生成する
    - API 設定とベース URL の設定を行う
    - Cookie 認証の自動処理設定を実装する
    - _Requirements: 全要件_

  - [ ] 9.2 日時フォーマットユーティリティの実装

    - ISO8601 から JST 表示への変換関数を実装する
    - 相対時間表示（○ 分前）の機能を実装する
    - _Requirements: 5_

  - [ ] 9.3 Cookie 認証管理の実装
    - 初回アクセス時の署名 Cookie 取得機能を実装する
    - Cookie 期限切れ検知機能を実装する
    - 自動 Cookie 再取得機能を実装する（必要に応じて）
    - _Requirements: 6, 7, 8_

- [ ] 10. コメント機能のフロントエンド実装

  - [ ] 10.1 CommentSection コンポーネントの実装

    - コメント一覧表示機能を実装する
    - コメント投稿フォームを実装する
    - 投稿者名の「匿名」デフォルト機能を実装する
    - _Requirements: 1, 5_

  - [ ] 10.2 コメント編集・削除機能の実装
    - 自分のコメントの判定機能を実装する
    - 編集・削除ボタンの表示制御を実装する
    - インライン編集フォームを実装する
    - 削除確認ダイアログを実装する
    - _Requirements: 6, 7, 8_

- [ ] 11. いいね機能のフロントエンド実装

  - [ ] 11.1 LikeButton コンポーネントの実装

    - いいねボタンとカウント表示を実装する
    - ローカルストレージでの状態管理を実装する
    - ページリロード時の状態復元機能を実装する
    - _Requirements: 2_

  - [ ] 11.2 いいねトグル機能の実装
    - いいねボタンクリック時の API 呼び出しを実装する
    - 楽観的 UI 更新（即座にボタン状態変更）を実装する
    - エラー時のロールバック機能を実装する
    - _Requirements: 2_

- [ ] 12. 記事ページへの統合

  - [ ] 12.1 既存記事ページの修正

    - 記事テンプレートに CommentSection を追加する
    - 記事テンプレートに LikeButton を追加する
    - レスポンシブデザインの調整を行う
    - _Requirements: 1, 2_

  - [ ] 12.2 スタイリングの実装
    - TailwindCSS でコンポーネントのスタイリングを行う
    - ダークモード対応を行う
    - アニメーション効果を追加する
    - _Requirements: 全要件_

- [ ] 13. テストの実装

  - [ ] 13.1 バックエンドテストの実装

    - Repository 層のユニットテストを実装する
    - UseCase 層のユニットテストを実装する
    - Handler 層の統合テストを実装する
    - _Requirements: 全要件_

  - [ ] 13.2 フロントエンドテストの実装
    - コンポーネントのユニットテストを実装する
    - API 通信の統合テストを実装する
    - E2E テストのシナリオを実装する
    - _Requirements: 全要件_

- [ ] 14. デプロイメントと最終調整

  - [ ] 14.1 本番環境設定

    - 環境変数の設定を行う
    - データベースマイグレーションを実行する
    - バックエンドサーバーのデプロイを行う
    - _Requirements: 全要件_

  - [ ] 14.2 動作確認と調整
    - 全機能の動作確認を行う
    - パフォーマンスの最適化を行う
    - セキュリティの最終チェックを行う
    - _Requirements: 全要件_
